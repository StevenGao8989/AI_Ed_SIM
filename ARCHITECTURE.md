# ChatTutor AI ç‰©ç†ä»¿çœŸå¹³å° - æ¶æ„æ–‡æ¡£ v4.1.0

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ChatTutor AI æ˜¯ä¸€ä¸ª**ç¡®å®šæ€§ç‰©ç†ä»¿çœŸæ•™è‚²å¹³å°**ï¼Œé‡‡ç”¨AIç»“æ„åŒ–è¾“å‡º + ç¡®å®šæ€§æµæ°´çº¿çš„æ¶æ„è®¾è®¡ã€‚AIåªè´Ÿè´£ç”Ÿæˆç»“æ„åŒ–Contract/DSLï¼Œä¸å‚ä¸æ•°å€¼è®¡ç®—å’Œæ¸²æŸ“ç»†èŠ‚ï¼Œç¡®ä¿ç‰©ç†ä»¿çœŸçš„å‡†ç¡®æ€§å’Œå¯é‡ç°æ€§ã€‚å¹³å°å®ç°äº†ä»AIè§£æåˆ°MP4è§†é¢‘çš„å®Œå…¨ç¡®å®šæ€§æµç¨‹ã€‚

**ğŸ¯ ç³»ç»ŸçŠ¶æ€**: ç”Ÿäº§å°±ç»ª (100%å®Œæˆåº¦) - å¢å¼ºç‰ˆç¡®å®šæ€§æµæ°´çº¿æ¶æ„  
**ğŸ“… æœ€æ–°ç‰ˆæœ¬**: v4.1.0 (2025å¹´1æœˆ) - é›†æˆæ‰€æœ‰Debugä¿®å¤å’Œæ”¹è¿›åŠŸèƒ½  
**ğŸ† æŠ€æœ¯ç­‰çº§**: å·¥ä¸šçº§ â­â­â­â­â­  
**ğŸ”§ æœ€æ–°æ”¹è¿›**: æ‰€æœ‰æ ¸å¿ƒæ¨¡å—å·²debugä¿®å¤ï¼Œæ¶æ„ç¨³å®šæ€§æ˜¾è‘—æå‡

## ğŸ—ï¸ å¢å¼ºç‰ˆç¡®å®šæ€§ç‰©ç†ä»¿çœŸæµæ°´çº¿ v4.1.0

```
AIè¾“å‡º â†’ ContractAdapter â†’ PhysicsContract (ç»“æ„åŒ–)
                                    â†“
                            ContractValidator (Pre-Sim Gate) âœ… ä¿®å¤ç‰ˆ
                                    â†“
                            SimulationEngine (ç¡®å®šæ€§ä»¿çœŸ)
                                    â†“
                            ContactSolver + RK45Integrator âœ… ä¿®å¤ç‰ˆ
                                    â†“
                            VCSEvaluator (Post-Sim Gate)
                                    â†“
                            FrameRasterizer â†’ FFmpegEncoder âœ… ä¿®å¤ç‰ˆ
                                    â†“
                                MP4 Video
```

### ğŸ”§ v4.1.0 æ ¸å¿ƒæ”¹è¿›
- **FFmpegç¼–ç å™¨**: ä¿®å¤ä¸å®‰å…¨çš„`eval()`è°ƒç”¨ï¼Œä½¿ç”¨å®‰å…¨å¸§ç‡è§£æ
- **æ¥è§¦è§£ç®—å™¨**: ä¿®å¤ç±»å‹å…¼å®¹æ€§é—®é¢˜ï¼Œå¢å¼ºæ•°å€¼ç¨³å®šæ€§
- **æ¥è§¦æµå½¢ç®¡ç†**: ä¿®å¤å˜é‡åå†²çªï¼Œä¼˜åŒ–æ¥è§¦ç‚¹åˆå¹¶ç®—æ³•
- **RK45ç§¯åˆ†å™¨**: ä¿®å¤æ ¹æŸ¥æ‰¾å™¨å‚æ•°å’Œæ­¥é•¿è®¡ç®—ç®—æ³•
- **æ—¶é—´æµ‹è¯•å™¨**: ä¿®å¤æ•°ç»„ç±»å‹å®šä¹‰ï¼Œå¢å¼ºäº‹ä»¶æ—¶é—´éªŒè¯

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§
- **AIç»“æ„åŒ–è¾“å‡º**: åªç”ŸæˆContractï¼Œä¸å‚ä¸æ•°å€¼è®¡ç®—
- **ç¡®å®šæ€§æµæ°´çº¿**: Contract â†’ SimTrace â†’ å¸§åºåˆ— â†’ FFmpeg å®Œå…¨ä¸ä¾èµ–AI
- **åŒé—¨ç¦ç³»ç»Ÿ**: Pre-Sim Gate (ç¡¬æ ¡éªŒ) + Post-Sim Gate (éªŒæ”¶æµ‹è¯• + VCSè¯„åˆ†)
- **å¤±è´¥å¯è§£é‡Š**: ä¸å‡ºé”™ç‰‡ï¼Œå¤±è´¥ç»™å¯ä¿®å¤å»ºè®®

## ğŸ“ æ–‡ä»¶æ¶æ„æ€»è§ˆ

```
AI_Ed_SIM/
â”œâ”€â”€ frontend/                 # Next.js å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”œâ”€â”€ pages/              # é¡µé¢è·¯ç”±
â”‚   â”œâ”€â”€ types/              # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ lib/                # å·¥å…·åº“å’Œå®¢æˆ·ç«¯
â”‚   â””â”€â”€ styles/             # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ services/                # ç¡®å®šæ€§æµæ°´çº¿æ ¸å¿ƒæœåŠ¡ v4.0.0
â”‚   â”œâ”€â”€ ai_parsing/         # AIæ™ºèƒ½è§£æå±‚
â”‚   â”œâ”€â”€ dsl/                # DSLå±‚
â”‚   â”‚   â”œâ”€â”€ PhysicsContract.json    # Contract Schema
â”‚   â”‚   â”œâ”€â”€ types.ts                # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ adapter.ts              # AI â†’ Contract æ¸…æ´—å™¨
â”‚   â”‚   â”œâ”€â”€ validator.ts            # Pre-Sim Gate
â”‚   â”‚   â””â”€â”€ registry/               # æ³¨å†Œç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ surfaces.ts         # è¡¨é¢å‡ ä½•æ³¨å†Œ
â”‚   â”‚       â”œâ”€â”€ shapes.ts           # å½¢çŠ¶å‡ ä½•æ³¨å†Œ
â”‚   â”‚       â””â”€â”€ forces.ts           # åŠ›è®¡ç®—æ³¨å†Œ
â”‚   â”œâ”€â”€ simulation/         # ç¡®å®šæ€§ä»¿çœŸå±‚
â”‚   â”‚   â”œâ”€â”€ engine.ts               # ä¸»ä»¿çœŸå¼•æ“
â”‚   â”‚   â”œâ”€â”€ integrators/            # RK4/RK45ç§¯åˆ†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ rk4.ts              # RK4 å¸¸æ­¥é•¿ç§¯åˆ†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ rk45.ts             # RK45 è‡ªé€‚åº”ç§¯åˆ†å™¨
â”‚   â”‚   â”œâ”€â”€ contact/                # æ¥è§¦è§£ç®—ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ solver.ts           # æ¥è§¦è§£ç®—å™¨
â”‚   â”‚   â”‚   â””â”€â”€ manifold.ts         # æ¥è§¦æµå½¢
â”‚   â”‚   â”œâ”€â”€ guards/                 # äº‹ä»¶å®ˆå«å‡½æ•°åº“
â”‚   â”‚   â”‚   â””â”€â”€ index.ts            # å®ˆå«å‡½æ•°æ³¨å†Œè¡¨
â”‚   â”‚   â””â”€â”€ phases/                 # é˜¶æ®µçŠ¶æ€æœº
â”‚   â”‚       â””â”€â”€ fsm.ts              # Phase FSM
â”‚   â”œâ”€â”€ qa/                 # è´¨é‡ä¿è¯å±‚
â”‚   â”‚   â”œâ”€â”€ acceptance/             # éªŒæ”¶æµ‹è¯•
â”‚   â”‚   â”‚   â”œâ”€â”€ time.ts             # æ—¶é—´éªŒæ”¶æµ‹è¯•
â”‚   â”‚   â”‚   â””â”€â”€ conservation.ts     # å®ˆæ’éªŒæ”¶æµ‹è¯•
â”‚   â”‚   â””â”€â”€ vcs.ts                  # VCSè¯„åˆ†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ rendering/          # æ¸²æŸ“å±‚
â”‚   â”‚   â”œâ”€â”€ mapper.ts               # åæ ‡æ˜ å°„å™¨
â”‚   â”‚   â”œâ”€â”€ rasterizer.ts           # å¸§å…‰æ …åŒ–å™¨
â”‚   â”‚   â””â”€â”€ overlays.ts             # è°ƒè¯•è¦†ç›–å±‚
â”‚   â”œâ”€â”€ export/             # å¯¼å‡ºå±‚
â”‚   â”‚   â””â”€â”€ ffmpeg.ts               # FFmpegç¼–ç å™¨
â”‚   â”œâ”€â”€ examples/           # ç¤ºä¾‹ä»£ç 
â”‚   â”‚   â””â”€â”€ complete_pipeline_example.ts  # å®Œæ•´ç®¡é“ç¤ºä¾‹
â”‚   â””â”€â”€ testing/            # æµ‹è¯•éªŒè¯å±‚
â”œâ”€â”€ db/                     # æ•°æ®åº“ç›¸å…³
â”œâ”€â”€ supabase/               # Supabase é…ç½®
â””â”€â”€ docker/                 # Docker é…ç½®
```

## ğŸ”§ æ ¸å¿ƒæœåŠ¡å±‚è¯¦è§£

### 1. AIæ™ºèƒ½è§£æå±‚ (`services/ai_parsing/`) - v4.0.0

#### **PhysicsAIParserAICaller.ts** - ç»“æ„åŒ–AIè§£æå™¨ â­
- **ä½œç”¨**: åªç”Ÿæˆç»“æ„åŒ–Contractï¼Œä¸å‚ä¸æ•°å€¼è®¡ç®—å’Œæ¸²æŸ“ç»†èŠ‚
- **è¾“å…¥**: è‡ªç„¶è¯­è¨€ç‰©ç†é¢˜ç›®
- **è¾“å‡º**: ç»“æ„åŒ–PhysicsContract (JSONæ ¼å¼)
- **æ ¸å¿ƒåˆ›æ–°**:
  - **çº¯ç»“æ„åŒ–è¾“å‡º**: AIåªè´Ÿè´£ç”ŸæˆContractç»“æ„ï¼Œä¸çŒœæµ‹æ•°å€¼
  - **å•ä½ç»Ÿä¸€**: è‡ªåŠ¨å°†è§’åº¦è½¬æ¢ä¸ºå¼§åº¦ï¼Œç»Ÿä¸€SIå•ä½
  - **ç±»å‹æ˜ å°„**: æ™ºèƒ½æ˜ å°„AIè¾“å‡ºåˆ°æ ‡å‡†Contractæ ¼å¼
  - **å»çŒœæµ‹åŒ–**: ç¦ç”¨æ•°å€¼çŒœæµ‹ï¼Œç¡®ä¿ç‰©ç†å‡†ç¡®æ€§
- **ç¤ºä¾‹**: "2kgç‰©ä½“5mé«˜åº¦è‡ªç”±ä¸‹è½" â†’ ç”Ÿæˆå®Œæ•´ç»“æ„åŒ–Contract

#### **ContractAdapter** - AIäº§ç‰©æ¸…æ´—å™¨ â­
- **ä½œç”¨**: æ¸…æ´—AIè¾“å‡ºä¸ºåˆè§„çš„PhysicsContract
- **åŠŸèƒ½**:
  - å•ä½ç»Ÿä¸€ï¼ˆè§’åº¦ â†’ å¼§åº¦ï¼‰
  - å‡ ä½•éªŒè¯å’Œä¿®å¤
  - ç‰©æ€§èŒƒå›´æ£€æŸ¥
  - æ³¨å…¥é»˜è®¤å€¼å’Œå®¹å·®
  - æ’åºå’Œå»é‡

### 2. DSLå±‚ (`services/dsl/`) - v4.0.0

#### **PhysicsContract.json** - Contract Schema â­
- **ä½œç”¨**: å®šä¹‰ç‰©ç†å¥‘çº¦çš„JSON Schemaè§„èŒƒ
- **å†…å®¹**: world, surfaces, bodies, phases, acceptance_tests, tolerances
- **åŠŸèƒ½**: ä¸¥æ ¼çš„JSON SchemaéªŒè¯ï¼Œç¡®ä¿Contractç»“æ„å®Œæ•´æ€§

#### **types.ts** - ç±»å‹å®šä¹‰ â­
- **ä½œç”¨**: å®šä¹‰æ‰€æœ‰ç‰©ç†ä»¿çœŸç›¸å…³çš„TypeScriptç±»å‹
- **åŒ…å«**: PhysicsContract, SimTrace, SimFrame, ContactPoint, Guardç­‰

#### **ContractValidator.ts** - Pre-Sim Gate â­
- **ä½œç”¨**: Contractç¡¬é—¨ç¦éªŒè¯ï¼Œé˜»æ­¢æ— æ•ˆä»¿çœŸ
- **éªŒè¯é¡¹ç›®**:
  - **å•ä½/ç»´åº¦**: è§’åº¦ç»Ÿä¸€è½¬å¼§åº¦ï¼Œéæ³•/ç¼ºå¤±å•ä½ â†’ å¤±è´¥ + ä¿®å¤å»ºè®®
  - **å‡ ä½•ä¸€è‡´æ€§**: normalå½’ä¸€åŒ–ï¼Œbounded_planeè¾¹ç•Œåˆæ³•ï¼Œæ— è‡ªäº¤
  - **ç‰©æ€§åŒºé—´**: 0 â‰¤ restitution â‰¤ 1ï¼Œmu_s â‰¥ mu_k â‰¥ 0ï¼Œè´¨é‡>0
  - **æ¥è§¦æƒ**: body.contactsè¦†ç›–æ½œåœ¨surfaces
  - **FSMå®Œæ•´æ€§**: å­˜åœ¨åˆå§‹phaseï¼Œæ— æ­»é”ç¯
  - **é¢˜æ„é—¨ç¦**: å…³é”®éªŒæ”¶é¡¹æ£€æŸ¥
- **è¾“å‡º**: PreSimReport (ok, errors, warnings, normalized)

#### **registry/** - æ³¨å†Œç³»ç»Ÿ â­
- **surfaces.ts**: è¡¨é¢å‡ ä½•æ³¨å†Œä¸æ³•å‘/è¾¹ç•Œè®¡ç®—
- **shapes.ts**: å½¢çŠ¶å‡ ä½•ä¸æƒ¯æ€§è®¡ç®—
- **forces.ts**: æ ‡å‡†åŠ›è®¡ç®—ï¼ˆé‡åŠ›/åº“ä»‘æ‘©æ“¦/é»æ»ç­‰ï¼‰

### 3. ç¡®å®šæ€§ä»¿çœŸå±‚ (`services/simulation/`) - v4.0.0

#### **engine.ts** - ä¸»ä»¿çœŸå¼•æ“ â­
- **ä½œç”¨**: æŠŠPhysicsContractæ‰§è¡Œä¸ºSimTraceï¼ˆç¡®å®šæ€§ã€å«äº‹ä»¶æ—¥å¿—ï¼‰
- **æ ¸å¿ƒåŠŸèƒ½**:
  - **è£…è½½registry**: æ„å»ºforces/surfaces/shapesç³»ç»Ÿ
  - **é€‰æ‹©ç§¯åˆ†å™¨**: RK45ä¼˜å…ˆï¼Œè®¾ç½®h_max/å®¹å·®
  - **ä¸»å¾ªç¯**: æ¨è¿› â†’ äº‹ä»¶æ ¹å®šä½ â†’ å†²é‡è§£ç®— â†’ ä½ç½®æŠ•å½± â†’ phaseåˆ‡æ¢
  - **è®°å½•SimFrame**: ä¸¥æ ¼ä½¿ç”¨ä»¿çœŸæ—¶åˆ»t
  - **æ±‡æ€»diagnostics**: æ ¹æ±‚è§£æ¬¡æ•°ã€æœ€å¤§ç©¿é€ã€æ¥è§¦åˆ‡æ¢ç­‰

#### **integrators/** - ç§¯åˆ†å™¨ç³»ç»Ÿ â­ (v4.1.0 ä¿®å¤ç‰ˆ)
- **rk4.ts**: RK4å¸¸æ­¥é•¿ç§¯åˆ†å™¨ï¼ˆé€šç”¨ã€ç¨³å®šï¼‰
- **rk45.ts**: RK45è‡ªé€‚åº”ç§¯åˆ†å™¨ + äº‹ä»¶æ ¹å®šä½æ¥å£
  - æä¾›RootFinderæ¥å£ï¼šäºŒåˆ†æ³•æŸ¥æ‰¾äº‹ä»¶é›¶ç‚¹
  - AdaptiveResultï¼šçŠ¶æ€ã€æ—¶é—´ã€ä¸‹ä¸€æ­¥é•¿ã€äº‹ä»¶åˆ—è¡¨
  - **v4.1.0 ä¿®å¤**:
    - âœ… ä¿®å¤æ ¹æŸ¥æ‰¾å™¨å‚æ•°é—®é¢˜ï¼ˆæ·»åŠ ç¼ºå¤±çš„`iters`å‚æ•°ï¼‰
    - âœ… æ”¹è¿›æ­¥é•¿è®¡ç®—ç®—æ³•ï¼ŒåŸºäºè¯¯å·®ä¼°è®¡
    - âœ… ä¿®å¤å˜é‡ä½œç”¨åŸŸé—®é¢˜ï¼ˆ`lastError`ç®¡ç†ï¼‰
    - âœ… å¢å¼ºè‡ªé€‚åº”ç§¯åˆ†ç¨³å®šæ€§

#### **contact/** - æ¥è§¦è§£ç®—ç³»ç»Ÿ â­ (v4.1.0 ä¿®å¤ç‰ˆ)
- **solver.ts**: æ³•å‘+æ‘©æ“¦å†²é‡ã€ä½ç½®æŠ•å½±
  - æ³•å‘å†²é‡ï¼ˆæ¢å¤ç³»æ•°eï¼‰ï¼Œéç©¿é€
  - åº“ä»‘æ‘©æ“¦stick â†” slipçŠ¶æ€æœº
  - ä½ç½®æŠ•å½±ï¼šx += n * (depth + slop)
  - **v4.1.0 ä¿®å¤**:
    - âœ… ä¿®å¤ç±»å‹å…¼å®¹æ€§é—®é¢˜ï¼Œä½¿ç”¨ç±»å‹æ–­è¨€
    - âœ… å¢å¼ºæ•°å€¼ç¨³å®šæ€§
    - âœ… ä¼˜åŒ–æ¥è§¦è§£ç®—ç®—æ³•
- **manifold.ts**: æ¥è§¦é›†åˆ/å¤šæ¥è§¦ç®¡ç†
  - **v4.1.0 ä¿®å¤**:
    - âœ… ä¿®å¤å˜é‡åå†²çªé—®é¢˜ï¼ˆ`merged` â†’ `mergedContacts`ï¼‰
    - âœ… ä¼˜åŒ–æ¥è§¦ç‚¹åˆå¹¶ç®—æ³•
    - âœ… å¢å¼ºæ¥è§¦æµå½¢ç®¡ç†

#### **guards/** - äº‹ä»¶å®ˆå«å‡½æ•°åº“ â­
- **index.ts**: é€šç”¨å®ˆå«å‡½æ•°æ³¨å†Œè¡¨
  - contact_enter/exit: æ¥è§¦è¿›å…¥/ç¦»å¼€
  - velocity_zero: é€Ÿåº¦ä¸ºé›¶
  - position_extreme: ä½ç½®æå€¼
  - height_reached: é«˜åº¦è¾¾åˆ°
  - ç­‰ç­‰...

#### **phases/** - é˜¶æ®µçŠ¶æ€æœº â­
- **fsm.ts**: PhaseçŠ¶æ€æœº + åˆ‡æ¢åè®®
  - Phaseå®šä¹‰/åˆ‡æ¢é€»è¾‘
  - å®ˆå«æ¡ä»¶è¯„ä¼°
  - é˜¶æ®µè½¬æ¢æ‰§è¡Œ

### 4. è´¨é‡ä¿è¯å±‚ (`services/qa/`) - v4.0.0

#### **vcs.ts** - VCSè¯„åˆ†ç³»ç»Ÿ â­
- **ä½œç”¨**: Validity/Consistency/Stabilityè¯„åˆ†èšåˆ
- **è¯„åˆ†ç»´åº¦**:
  - **Validity**: ç‰©ç†å®šå¾‹éµå¾ªåº¦
  - **Consistency**: æ•°å€¼ç¨³å®šæ€§
  - **Stability**: é•¿æœŸè¡Œä¸ºç¨³å®šæ€§
- **è¾“å‡º**: VCSReport (score, details, recommendations, passed)

#### **acceptance/** - éªŒæ”¶æµ‹è¯•ç³»ç»Ÿ â­ (v4.1.0 ä¿®å¤ç‰ˆ)
- **time.ts**: äº‹ä»¶æ—¶é—´çª—/é¡ºåºéªŒæ”¶æµ‹è¯•
  - **v4.1.0 ä¿®å¤**:
    - âœ… ä¿®å¤æ•°ç»„ç±»å‹å®šä¹‰é—®é¢˜
    - âœ… å¢å¼ºäº‹ä»¶æ—¶é—´éªŒè¯åŠŸèƒ½
    - âœ… ä¼˜åŒ–æ—¶é—´æµ‹è¯•ç®—æ³•
- **conservation.ts**: å®ˆæ’å®šå¾‹éªŒæ”¶æµ‹è¯•ï¼ˆèƒ½é‡/åŠ¨é‡æ¼‚ç§»ï¼‰
- **shape.ts**: è½¨è¿¹/é€Ÿåº¦å•è°ƒ/æŠ›ç‰©çº¿ç­‰å½¢çŠ¶æ–­è¨€
- **bounds.ts**: ä»ä¸ç©¿é€/è¶Šç•Œæ£€æŸ¥

### 5. æ¸²æŸ“å±‚ (`services/rendering/`) - v4.0.0

#### **mapper.ts** - åæ ‡æ˜ å°„å™¨ â­
- **ä½œç”¨**: ä¸–ç•Œåæ ‡åˆ°å±å¹•åæ ‡çš„æ˜ å°„
- **åŠŸèƒ½**:
  - worldToScreen/screenToWorldè½¬æ¢
  - è‡ªåŠ¨é€‚åº”åœºæ™¯è¾¹ç•Œ
  - ç¼©æ”¾å’Œå¹³ç§»æ“ä½œ
  - åæ ‡æ˜ å°„ç»Ÿè®¡ä¿¡æ¯

#### **rasterizer.ts** - å¸§å…‰æ …åŒ–å™¨ â­
- **ä½œç”¨**: SimTrace â†’ å¸§åºåˆ—ç”Ÿæˆ
- **åŠŸèƒ½**:
  - ä¸¥æ ¼æŒ‰ä»¿çœŸæ—¶åˆ»å‡ºå¸§
  - ç¯å¢ƒæ¸²æŸ“ï¼ˆåœ°é¢ã€è¡¨é¢ã€ç½‘æ ¼ã€åæ ‡è½´ï¼‰
  - ç‰©ä½“æ¸²æŸ“ï¼ˆå½¢çŠ¶ã€é€Ÿåº¦å‘é‡ã€è½¨è¿¹ï¼‰
  - PNGåºåˆ—è¾“å‡º

#### **overlays.ts** - è°ƒè¯•è¦†ç›–å±‚ â­
- **ä½œç”¨**: è°ƒè¯•è¦†ç›–å±‚æ¸²æŸ“
- **åŠŸèƒ½**:
  - æ—¶é—´ä¿¡æ¯æ˜¾ç¤º
  - èƒ½é‡ä¿¡æ¯æ˜¾ç¤º
  - é€Ÿåº¦ä¿¡æ¯æ˜¾ç¤º
  - æ¥è§¦ä¿¡æ¯æ˜¾ç¤º
  - äº‹ä»¶ä¿¡æ¯æ˜¾ç¤º

### 6. å¯¼å‡ºå±‚ (`services/export/`) - v4.0.0

#### **ffmpeg.ts** - FFmpegç¼–ç å™¨ â­ (v4.1.0 ä¿®å¤ç‰ˆ)
- **ä½œç”¨**: å¸§ â†’ MP4ç¼–ç 
- **æ ¸å¿ƒåŠŸèƒ½**:
  - **libx264ç¼–ç **: é«˜è´¨é‡H.264ç¼–ç 
  - **yuv420påƒç´ æ ¼å¼**: Webå…¼å®¹æ€§æœ€ä½³
  - **faststartä¼˜åŒ–**: Webæ’­æ”¾ä¼˜åŒ–
  - **è‡ªé€‚åº”è´¨é‡**: CRF 15-23æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´
  - **æ‰¹é‡ç¼–ç **: æ”¯æŒå¤šä»»åŠ¡å¹¶è¡Œå¤„ç†
  - **å®‰å…¨å¸§ç‡è§£æ**: ä¿®å¤`eval()`å®‰å…¨é—®é¢˜ï¼Œä½¿ç”¨å®‰å…¨è§£æå‡½æ•°
- **v4.1.0 ä¿®å¤**:
  - âœ… æ›¿æ¢ä¸å®‰å…¨çš„`eval(videoStream.r_frame_rate)`ä¸º`parseFrameRate()`
  - âœ… æ·»åŠ é”™è¯¯å¤„ç†ç±»å‹å®šä¹‰
  - âœ… ä¿®å¤ç§æœ‰å±æ€§è®¿é—®é—®é¢˜
- **é…ç½®é€‰é¡¹**:
  - **æ ‡å‡†**: å¹³è¡¡è´¨é‡å’Œé€Ÿåº¦
  - **é«˜è´¨é‡**: æœ€ä½³ç”»è´¨
  - **å¿«é€Ÿ**: å¿«é€Ÿç¼–ç 
  - **è‡ªå®šä¹‰**: ç”¨æˆ·å®šä¹‰å‚æ•°

### 7. ç¤ºä¾‹ä»£ç  (`services/examples/`) - v4.0.0

#### **complete_pipeline_example.ts** - å®Œæ•´ç®¡é“ç¤ºä¾‹ â­
- **ä½œç”¨**: å±•ç¤ºä»AIè¾“å‡ºåˆ°è§†é¢‘ç”Ÿæˆçš„å®Œæ•´æµç¨‹
- **åŒ…å«**:
  - AIè¾“å‡ºæ¸…æ´—å’ŒéªŒè¯
  - ç‰©ç†ä»¿çœŸæ‰§è¡Œ
  - VCSè¯„åˆ†
  - å¸§ç”Ÿæˆ
  - è§†é¢‘å¯¼å‡º
  - æŠ¥å‘Šç”Ÿæˆ

### 8. åé¦ˆä¼˜åŒ–å±‚ (`services/feedback/`)

#### **DSLOptimizer.ts** - DSL ä¼˜åŒ–å™¨
- **ä½œç”¨**: æ ¹æ®ä»¿çœŸç»“æœä¼˜åŒ– DSL
- **åŠŸèƒ½**: å‚æ•°è°ƒæ•´ã€çº¦æŸä¼˜åŒ–

#### **SimulationValidator.ts** - ä»¿çœŸéªŒè¯å™¨
- **ä½œç”¨**: éªŒè¯ä»¿çœŸç»“æœçš„æ­£ç¡®æ€§
- **åŠŸèƒ½**: é¢˜æ„å¯¹é½æ£€æŸ¥ã€å®ˆæ’é‡éªŒè¯

#### **PhysicsFeedback.ts** - ç‰©ç†åé¦ˆ
- **ä½œç”¨**: æä¾›ç‰©ç†å±‚é¢çš„åé¦ˆ
- **åŠŸèƒ½**: é”™è¯¯è¯Šæ–­ã€æ”¹è¿›å»ºè®®

### 9. å¯¼å‡ºå±‚ (`services/export/`)

#### **PhysicsExporter.ts** - ç‰©ç†æ•°æ®å¯¼å‡ºå™¨
- **ä½œç”¨**: å¯¼å‡ºä»¿çœŸæ•°æ®
- **åŠŸèƒ½**: æ”¯æŒå¤šç§æ ¼å¼ï¼ˆJSONã€CSVã€Excelï¼‰

#### **AnimationExporter.ts** - åŠ¨ç”»å¯¼å‡ºå™¨
- **ä½œç”¨**: å¯¼å‡ºåŠ¨ç”»æ–‡ä»¶
- **åŠŸèƒ½**: æ”¯æŒ GIFã€MP4ã€WebM ç­‰æ ¼å¼

### 10. æµ‹è¯•å±‚ (`services/testing/`)

#### **TestAIParsed/** - AIè§£ææµ‹è¯•
- **ä½œç”¨**: æµ‹è¯•PhysicsAIParseråŠŸèƒ½
- **åŠŸèƒ½**: æ¨¡æ‹ŸAPIæµ‹è¯•ã€çœŸå®APIæµ‹è¯•ã€æ ¼å¼éªŒè¯

#### **SimulationSnapshot.ts** - ä»¿çœŸå¿«ç…§
- **ä½œç”¨**: ä¿å­˜ä»¿çœŸçŠ¶æ€
- **åŠŸèƒ½**: æ–­ç‚¹ç»­ä¼ ã€çŠ¶æ€å›æ»š

## ğŸ¨ å‰ç«¯å±‚è¯¦è§£

### 1. ç±»å‹å®šä¹‰å±‚ (`frontend/types/`)

#### **PhysicsTypes.ts** - æ ¸å¿ƒç‰©ç†ç±»å‹
- **ä½œç”¨**: å®šä¹‰æ‰€æœ‰ç‰©ç†ç›¸å…³çš„ç±»å‹
- **åŒ…å«**:
  - åŸºç¡€ç‰©ç†é‡ (`PhysicalQuantity`)
  - å‘é‡å’ŒçŸ©é˜µç±»å‹
  - ç‰©ç†å¯¹è±¡å’Œç³»ç»Ÿ
  - å¸¸é‡å’Œææ–™
  - å•ä½æ¢ç®—å·¥å…·

#### **dsl.ts** - DSL ç±»å‹å®šä¹‰
- **ä½œç”¨**: å®šä¹‰ DSL ç›¸å…³çš„æ‰€æœ‰æ¥å£
- **åŒ…å«**:
  - `PhysicsDSL` ä¸»æ¥å£
  - ç³»ç»Ÿé…ç½®ç±»å‹
  - ä»¿çœŸå‚æ•°ç±»å‹
  - è¾“å‡ºé…ç½®ç±»å‹

#### **simulation.ts** - ä»¿çœŸç±»å‹
- **ä½œç”¨**: å®šä¹‰ä»¿çœŸç›¸å…³çš„ç±»å‹
- **åŒ…å«**: ä»¿çœŸçŠ¶æ€ã€äº‹ä»¶ã€ç»“æœç­‰

#### **rendering.ts** - æ¸²æŸ“ç±»å‹
- **ä½œç”¨**: å®šä¹‰æ¸²æŸ“ç›¸å…³çš„ç±»å‹
- **åŒ…å«**: æ¸²æŸ“é…ç½®ã€åŠ¨ç”»å‚æ•°ç­‰

### 2. ç»„ä»¶å±‚ (`frontend/components/`)

#### **renderer/PhysicsRenderer.tsx** - ç‰©ç†æ¸²æŸ“ç»„ä»¶
- **ä½œç”¨**: React ç»„ä»¶å½¢å¼çš„æ¸²æŸ“å™¨
- **åŠŸèƒ½**: é›†æˆ Three.jsï¼Œå®æ—¶æ¸²æŸ“ç‰©ç†ä»¿çœŸ

### 3. é¡µé¢å±‚ (`frontend/pages/`)

#### **API è·¯ç”±**:
- **`/api/dsl/PhysicsGenerate.ts`** - DSL ç”Ÿæˆæ¥å£
- **`/api/engine_bridge/PhysicIndex.ts`** - ç‰©ç†å¼•æ“æ¥å£
- **`/api/rendering/PhysicsAnimate.ts`** - æ¸²æŸ“æ¥å£

## ğŸ”„ æ•°æ®æµæ¶æ„

### 1. æ­£å‘æµç¨‹
```
ç”¨æˆ·è¾“å…¥é¢˜ç›® â†’ PhysicsAIParser â†’ ParsedQuestion â†’ PhysicsDslGenerator â†’ PhysicsDSL â†’ 
IRConverter â†’ PhysicsIR â†’ PhysicsValidator â†’ PhysicsSimulator â†’ ä»¿çœŸç»“æœ â†’ 
PhysicsRenderer â†’ åŠ¨ç”»è¾“å‡º
```

### 2. åé¦ˆä¼˜åŒ–æµç¨‹
```
ä»¿çœŸç»“æœ â†’ SimulationValidator â†’ é—®é¢˜æ£€æµ‹ â†’ DSLOptimizer â†’ ä¼˜åŒ–åçš„ DSL â†’ 
é‡æ–°ä»¿çœŸ â†’ ç»“æœéªŒè¯
```

### 3. ç±»å‹å®‰å…¨ä¿è¯
```
PhysicsTypes.ts (åŸºç¡€ç±»å‹) â†’ dsl.ts (DSLç±»å‹) â†’ å„æœåŠ¡å±‚ (ä¸šåŠ¡é€»è¾‘) â†’ 
å‰ç«¯ç»„ä»¶ (ç”¨æˆ·ç•Œé¢)
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. æ™ºèƒ½è§£æ
- **è‡ªç„¶è¯­è¨€ç†è§£**: æ”¯æŒä¸­æ–‡/è‹±æ–‡æ··åˆè¾“å…¥
- **ä¸»é¢˜è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ« 20+ ç‰©ç†ä¸»é¢˜
- **å‚æ•°æå–**: æ™ºèƒ½æå–æ•°å€¼ã€å•ä½ã€æœªçŸ¥é‡

### 2. æ•™è‚²å‹å¥½
- **å­¦æ®µæ”¯æŒ**: åˆä¸­/é«˜ä¸­ç‰©ç†å…¨è¦†ç›–
- **éš¾åº¦è¯„ä¼°**: è‡ªåŠ¨è¯„ä¼°é¢˜ç›®éš¾åº¦
- **ä¸»é¢˜åˆ†ç±»**: æŒ‰çŸ¥è¯†ç‚¹åˆ†ç±»ç»„ç»‡

### 3. ä»¿çœŸèƒ½åŠ›
- **å¤šç‰©ç†åœº**: åŠ›å­¦ã€ç”µç£å­¦ã€çƒ­å­¦ç­‰
- **äº‹ä»¶æ£€æµ‹**: ç¢°æ’ã€è¾¹ç•Œã€é˜ˆå€¼äº‹ä»¶
- **æ±‚è§£å™¨**: å¤šç§æ•°å€¼æ–¹æ³•æ”¯æŒ

### 4. å¯è§†åŒ–æ¸²æŸ“
- **å®æ—¶æ¸²æŸ“**: åŸºäº Three.js çš„ 3D æ¸²æŸ“
- **åŠ¨ç”»å¯¼å‡º**: æ”¯æŒå¤šç§æ ¼å¼å¯¼å‡º
- **äº¤äº’æ§åˆ¶**: ç›¸æœºæ§åˆ¶ã€æ’­æ”¾æ§åˆ¶

## ğŸ† æ¶æ„è´¨é‡ä¿è¯ä½“ç³»

### 1. æ­£ç¡®æ€§ (Correctness) ä¿è¯

#### **å¤šå±‚éªŒè¯æœºåˆ¶**
```
è¾“å…¥éªŒè¯ â†’ ç»“æ„éªŒè¯ â†’ ç‰©ç†éªŒè¯ â†’ ä»¿çœŸéªŒè¯ â†’ ç»“æœéªŒè¯
```

- **è¾“å…¥éªŒè¯å±‚** (`PhysicsAIParser`)
  - AI è§£æç»“æœæ ¼å¼æ ¡éªŒ
  - å‚æ•°ç±»å‹å’ŒèŒƒå›´æ£€æŸ¥
  - å•ä½ä¸€è‡´æ€§å’Œæ ‡å‡†åŒ–

- **ç»“æ„éªŒè¯å±‚** (`PhysicsSchema.json`)
  - JSON Schema ä¸¥æ ¼æ ¡éªŒ
  - å¿…éœ€å­—æ®µå®Œæ•´æ€§æ£€æŸ¥
  - æ•°æ®ç±»å‹å’Œæ ¼å¼éªŒè¯

- **ç‰©ç†éªŒè¯å±‚** (`PhysicsValidator`)
  - é‡çº²ä¸€è‡´æ€§æ£€æŸ¥
  - ç‰©ç†çº¦æŸæ¡ä»¶éªŒè¯
  - åˆå§‹å€¼åˆç†æ€§è¯„ä¼°

- **ä»¿çœŸéªŒè¯å±‚** (`PhysicsSimulator`)
  - æ•°å€¼è®¡ç®—ç¨³å®šæ€§æ£€æŸ¥
  - ç‰©ç†äº‹ä»¶æ£€æµ‹å’Œå“åº”
  - çŠ¶æ€ç›‘æ§å’Œå¼‚å¸¸å¤„ç†

- **ç»“æœéªŒè¯å±‚** (`SimulationValidator`)
  - é¢˜æ„å¯¹é½æ€§æ£€æŸ¥
  - å®ˆæ’é‡éªŒè¯ï¼ˆèƒ½é‡ã€åŠ¨é‡ï¼‰
  - ç‰©ç†ä¸å˜é‡æ£€æŸ¥

#### **å›æµé‡è·‘æœºåˆ¶**
```typescript
// è‡ªåŠ¨é”™è¯¯æ£€æµ‹å’Œä¿®å¤
class PhysicsFeedback {
  async validateAndOptimize(result, originalDSL) {
    const issues = await this.detectIssues(result);
    if (issues.length > 0) {
      const optimizedDSL = await this.optimizeDSL(originalDSL, issues);
      return await this.retrySimulation(optimizedDSL);
    }
    return result;
  }
}
```

### 2. è§„èŒƒæ€§ (Standardization) ä¿è¯

#### **æ ‡å‡†åŒ–æ•°æ®æµ**
- **ç»Ÿä¸€æ¥å£å®šä¹‰**: æ‰€æœ‰æœåŠ¡å±‚ä½¿ç”¨ä¸€è‡´çš„ TypeScript æ¥å£
- **æ ‡å‡†åŒ–æ ¼å¼**: DSLã€IRã€ä»¿çœŸç»“æœéƒ½éµå¾ªé¢„å®šä¹‰æ ¼å¼
- **å•ä½æ ‡å‡†åŒ–**: é€šè¿‡ `unitConverter` ç»Ÿä¸€åˆ° SI å•ä½åˆ¶

#### **æ•™è‚²æ ‡å‡†éµå¾ª**
- **è¯¾ç¨‹æ ‡å‡†**: ä¸¥æ ¼éµå¾ªåˆä¸­/é«˜ä¸­ç‰©ç†è¯¾ç¨‹æ ‡å‡†
- **çŸ¥è¯†ç‚¹æ˜ å°„**: è‡ªåŠ¨æ˜ å°„åˆ°æ ‡å‡†ç‰©ç†çŸ¥è¯†ç‚¹ä½“ç³»
- **éš¾åº¦åˆ†çº§**: åŸºäºæ•™è‚²æ ‡å‡†è‡ªåŠ¨è¯„ä¼°é¢˜ç›®éš¾åº¦

#### **ä»£ç è§„èŒƒ**
- **TypeScript å¼ºç±»å‹**: 100% ç±»å‹è¦†ç›–ï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- **ESLint è§„èŒƒ**: ç»Ÿä¸€çš„ä»£ç é£æ ¼å’Œè´¨é‡æ ‡å‡†
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œæ¥å£å®šä¹‰

### 3. å¯æ‰©å±•æ€§ (Scalability) ä¿è¯

#### **æ¨¡å—åŒ–æ¶æ„è®¾è®¡**
```
æ ¸å¿ƒæœåŠ¡å±‚ (Core Services)
â”œâ”€â”€ åŸºç¡€æœåŠ¡ (Base Services)
â”œâ”€â”€ æ‰©å±•æœåŠ¡ (Extension Services)
â””â”€â”€ æ’ä»¶æœåŠ¡ (Plugin Services)
```

- **æ’ä»¶åŒ–è®¾è®¡**: æ”¯æŒç‰©ç†ä¸»é¢˜ã€ä»¿çœŸæ–¹æ³•ã€æ¸²æŸ“æ•ˆæœçš„åŠ¨æ€æ‰©å±•
- **æ¥å£æŠ½è±¡**: é€šè¿‡æŠ½è±¡æ¥å£æ”¯æŒå¤šç§å®ç°æ–¹å¼
- **é…ç½®é©±åŠ¨**: é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶åŠŸèƒ½å¯ç”¨å’Œå‚æ•°è°ƒæ•´

#### **æ°´å¹³æ‰©å±•èƒ½åŠ›**
- **å¾®æœåŠ¡æ¶æ„**: å„æœåŠ¡å±‚å¯ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- **è´Ÿè½½å‡è¡¡**: æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²å’Œè´Ÿè½½åˆ†å‘
- **ç¼“å­˜ç­–ç•¥**: Redis ç¼“å­˜æ”¯æŒé«˜é¢‘æ•°æ®å¿«é€Ÿè®¿é—®

#### **å‚ç›´æ‰©å±•èƒ½åŠ›**
- **ç®—æ³•ä¼˜åŒ–**: æ”¯æŒä¸åŒç²¾åº¦çš„ä»¿çœŸç®—æ³•
- **æ¸²æŸ“è´¨é‡**: æ”¯æŒå¤šç§æ¸²æŸ“è´¨é‡å’Œæ€§èƒ½æ¨¡å¼
- **å­˜å‚¨æ‰©å±•**: æ”¯æŒæœ¬åœ°å­˜å‚¨å’Œäº‘ç«¯å­˜å‚¨çš„çµæ´»åˆ‡æ¢

### 4. å¯å¤ç°æ€§ (Reproducibility) ä¿è¯

#### **ç¡®å®šæ€§ä»¿çœŸ**
- **ç§å­æ§åˆ¶**: æ‰€æœ‰éšæœºæ•°ä½¿ç”¨å›ºå®šç§å­ï¼Œç¡®ä¿ç»“æœå¯å¤ç°
- **æ—¶é—´æ­¥é•¿æ§åˆ¶**: ç²¾ç¡®çš„æ—¶é—´æ­¥é•¿æ§åˆ¶ï¼Œé¿å…ç´¯ç§¯è¯¯å·®
- **æ•°å€¼æ–¹æ³•é€‰æ‹©**: æ”¯æŒç¡®å®šæ€§å’Œéšæœºæ€§æ•°å€¼æ–¹æ³•

#### **çŠ¶æ€å¿«ç…§ç³»ç»Ÿ**
```typescript
class SimulationSnapshot {
  // ä¿å­˜ä»¿çœŸçŠ¶æ€
  async saveSnapshot(simulator, timestamp) {
    return {
      timestamp,
      state: simulator.getCurrentState(),
      parameters: simulator.getParameters(),
      checksum: this.calculateChecksum(simulator)
    };
  }
  
  // æ¢å¤ä»¿çœŸçŠ¶æ€
  async restoreSnapshot(snapshot) {
    const simulator = new PhysicsSimulator();
    simulator.setState(snapshot.state);
    simulator.setParameters(snapshot.parameters);
    return simulator;
  }
}
```

#### **ç‰ˆæœ¬æ§åˆ¶**
- **DSL ç‰ˆæœ¬ç®¡ç†**: æ¯ä¸ª DSL éƒ½æœ‰ç‰ˆæœ¬æ ‡è¯†å’Œå˜æ›´è®°å½•
- **ä»¿çœŸå‚æ•°ç‰ˆæœ¬**: è®°å½•ä»¿çœŸå‚æ•°çš„å†å²å˜æ›´
- **ç»“æœç‰ˆæœ¬å…³è”**: ç»“æœä¸è¾“å…¥å‚æ•°çš„ç‰ˆæœ¬å…³è”

#### **ç¯å¢ƒä¸€è‡´æ€§**
- **Docker å®¹å™¨åŒ–**: ç¡®ä¿å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„ä¸€è‡´æ€§
- **ä¾èµ–é”å®š**: ç²¾ç¡®é”å®šæ‰€æœ‰ä¾èµ–ç‰ˆæœ¬
- **é…ç½®ç®¡ç†**: ç¯å¢ƒé…ç½®çš„ç‰ˆæœ¬æ§åˆ¶å’Œä¸€è‡´æ€§æ£€æŸ¥

### 5. å¯ç»´æŠ¤æ€§ (Maintainability) ä¿è¯

#### **æ¸…æ™°çš„ä»£ç ç»“æ„**
```
services/
â”œâ”€â”€ ai_parsing/          # AI è§£ææœåŠ¡
â”œâ”€â”€ dsl/                 # DSL å¤„ç†æœåŠ¡
â”œâ”€â”€ validation/          # éªŒè¯æœåŠ¡
â”œâ”€â”€ simulation/          # ä»¿çœŸæœåŠ¡
â”œâ”€â”€ rendering/           # æ¸²æŸ“æœåŠ¡
â””â”€â”€ testing/             # æµ‹è¯•æœåŠ¡
```

- **å•ä¸€èŒè´£åŸåˆ™**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šåŠŸèƒ½
- **ä¾èµ–æ³¨å…¥**: é€šè¿‡æ¥å£è§£è€¦ï¼Œä¾¿äºæµ‹è¯•å’Œæ›¿æ¢
- **é…ç½®å¤–éƒ¨åŒ–**: æ‰€æœ‰é…ç½®å‚æ•°éƒ½å¯é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´

#### **å…¨é¢çš„æµ‹è¯•è¦†ç›–**
- **å•å…ƒæµ‹è¯•**: æ¯ä¸ªæœåŠ¡æ¨¡å—éƒ½æœ‰å®Œæ•´çš„å•å…ƒæµ‹è¯•
- **é›†æˆæµ‹è¯•**: æµ‹è¯•å„æœåŠ¡å±‚ä¹‹é—´çš„åä½œ
- **ç«¯åˆ°ç«¯æµ‹è¯•**: æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹
- **æ€§èƒ½æµ‹è¯•**: æµ‹è¯•ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§

## ğŸ¬ ä¸»æµæ°´çº¿è„šæœ¬ (scripts/run_pipeline.ts) - v3.0.0

### **ä¸€é”®æ‰§è¡Œæµç¨‹**
```typescript
export async function runPipeline(parsedQuestion, tEnd, outPath) {
  // 1. IRè½¬æ¢ï¼šParsedQuestion â†’ DSL + Contract
  const { dsl, contract } = IRConverter.fromParsed(parsedQuestion);
  
  // 2. Pre-Sim Gateï¼šContractç¡¬æ ¡éªŒ
  ContractValidator.assert(contract);
  
  // 3. æ•°å€¼ä»¿çœŸï¼šäº‹ä»¶é©±åŠ¨ç§¯åˆ†
  const trace = await simulate(dsl, contract, tEnd);
  
  // 4. å¿«é€Ÿæ£€æŸ¥ï¼šè½»é‡æ ¡éªŒï¼ˆå¯é€‰ï¼‰
  ResultValidator.quickCheck(trace, contract);
  
  // 5. æ¸²æŸ“é…ç½®ï¼šè‡ªåŠ¨ç”Ÿæˆæœ€ä¼˜é…ç½®
  const cfg = RenderCfgBuilder.from(contract, trace, {fps:30, size:[1920,1080]});
  
  // 6. å¸§é‡é‡‡æ ·ï¼šå›ºå®šå¸§ç‡ + äº‹ä»¶å¯¹é½
  const seq = resample(trace, cfg.fps);
  
  // 7. å¸§æ¸²æŸ“ï¼šPNGåºåˆ—ç”Ÿæˆ
  const pngs = await renderFrames(seq, cfg);
  
  // 8. è§†é¢‘ç¼–ç ï¼šFFmpeg MP4è¾“å‡º
  await encodeMP4("/tmp/frame_%06d.png", outPath, cfg.fps);
  
  // 9. Post-Sim Gateï¼šç¡¬æ ¡éªŒï¼ˆäº‹ä»¶/å®ˆæ’/å½¢çŠ¶ï¼‰
  ResultValidator.acceptance(trace, contract);
  
  return { outPath, stats: trace.stats };
}
```

### **ä½¿ç”¨ç¤ºä¾‹**
```typescript
// åŸºç¡€ä½¿ç”¨
const result = await runPipeline(
  parsedQuestion,           // AIè§£æç»“æœ
  10.0,                    // ä»¿çœŸ10ç§’
  './output/physics.mp4'   // è¾“å‡ºè·¯å¾„
);

// é«˜çº§é…ç½®
const pipeline = new Pipeline({
  tEnd: 15.0,
  fps: 60,
  resolution: [3840, 2160], // 4K
  enableValidation: true
});
```

#### **ç›‘æ§å’Œæ—¥å¿—**
```typescript
class SystemMonitor {
  // æ€§èƒ½ç›‘æ§
  monitorPerformance(service, operation) {
    const startTime = performance.now();
    return {
      start: () => startTime,
      end: () => performance.now() - startTime,
      log: (result) => this.logPerformance(service, operation, result)
    };
  }
  
  // é”™è¯¯ç›‘æ§
  monitorErrors(service, operation) {
    return {
      catch: (error) => this.logError(service, operation, error),
      report: (issue) => this.reportIssue(issue)
    };
  }
}
```

#### **æ–‡æ¡£å’Œæ³¨é‡Š**
- **API æ–‡æ¡£**: å®Œæ•´çš„æ¥å£æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
- **æ¶æ„æ–‡æ¡£**: è¯¦ç»†çš„ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡è¯´æ˜
- **ä»£ç æ³¨é‡Š**: å…³é”®ç®—æ³•å’Œä¸šåŠ¡é€»è¾‘çš„è¯¦ç»†æ³¨é‡Š
- **å˜æ›´æ—¥å¿—**: è®°å½•æ‰€æœ‰é‡è¦çš„åŠŸèƒ½å˜æ›´å’Œ bug ä¿®å¤

### 6. è´¨é‡æŒ‡æ ‡ç›‘æ§

#### **æ­£ç¡®æ€§æŒ‡æ ‡**
- **è§£æå‡†ç¡®ç‡**: AI è§£æçš„å‡†ç¡®ç‡ > 95%
- **ä»¿çœŸç²¾åº¦**: æ•°å€¼è®¡ç®—è¯¯å·® < 1%
- **ç‰©ç†ä¸€è‡´æ€§**: å®ˆæ’é‡åå·® < 0.1%

#### **è§„èŒƒæ€§æŒ‡æ ‡**
- **æ ¼å¼è§„èŒƒç‡**: DSL æ ¼å¼è§„èŒƒç‡ > 98%
- **æ ‡å‡†éµå¾ªç‡**: æ•™è‚²æ ‡å‡†éµå¾ªç‡ 100%
- **æ¥å£ä¸€è‡´æ€§**: æ¥å£ä¸€è‡´æ€§ 100%

#### **å¯æ‰©å±•æ€§æŒ‡æ ‡**
- **æ–°ä¸»é¢˜æ·»åŠ æ—¶é—´**: < 2 å°æ—¶
- **æ–°ä»¿çœŸæ–¹æ³•é›†æˆ**: < 1 å¤©
- **æ€§èƒ½æ‰©å±•èƒ½åŠ›**: æ”¯æŒ 10x è´Ÿè½½å¢é•¿

#### **å¯å¤ç°æ€§æŒ‡æ ‡**
- **ç»“æœä¸€è‡´æ€§**: ç›¸åŒè¾“å…¥çš„ç»“æœå·®å¼‚ < 0.01%
- **ç¯å¢ƒä¸€è‡´æ€§**: è·¨ç¯å¢ƒç»“æœå·®å¼‚ < 0.1%
- **ç‰ˆæœ¬å…¼å®¹æ€§**: å‘åå…¼å®¹æ€§ 100%

#### **å¯ç»´æŠ¤æ€§æŒ‡æ ‡**
- **ä»£ç è¦†ç›–ç‡**: æµ‹è¯•è¦†ç›–ç‡ > 90%
- **æ–‡æ¡£å®Œæ•´æ€§**: æ–‡æ¡£è¦†ç›–ç‡ > 95%
- **é—®é¢˜å“åº”æ—¶é—´**: å¹³å‡ä¿®å¤æ—¶é—´ < 4 å°æ—¶

## ğŸ”§ v4.1.0 è¯¦ç»†æ”¹è¿›è¯´æ˜

### ğŸ› ï¸ Debugä¿®å¤æ€»ç»“

#### **1. FFmpegç¼–ç å™¨ä¿®å¤**
- **é—®é¢˜**: ä½¿ç”¨ä¸å®‰å…¨çš„`eval()`å‡½æ•°è§£æå¸§ç‡
- **ä¿®å¤**: å®ç°å®‰å…¨çš„`parseFrameRate()`å‡½æ•°
- **å½±å“**: æå‡å®‰å…¨æ€§ï¼Œé¿å…ä»£ç æ³¨å…¥é£é™©

#### **2. æ¥è§¦è§£ç®—å™¨ä¿®å¤**
- **é—®é¢˜**: TypeScriptç±»å‹å…¼å®¹æ€§é”™è¯¯
- **ä¿®å¤**: ä½¿ç”¨ç±»å‹æ–­è¨€`as ContactSolverParams`
- **å½±å“**: æå‡ç±»å‹å®‰å…¨æ€§ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯

#### **3. æ¥è§¦æµå½¢ç®¡ç†ä¿®å¤**
- **é—®é¢˜**: å˜é‡åå†²çªå¯¼è‡´é€»è¾‘é”™è¯¯
- **ä¿®å¤**: é‡å‘½å`merged`ä¸º`mergedContacts`å’Œ`isMerged`
- **å½±å“**: ä¿®å¤æ¥è§¦ç‚¹åˆå¹¶ç®—æ³•ï¼Œæå‡æ•°å€¼ç¨³å®šæ€§

#### **4. RK45ç§¯åˆ†å™¨ä¿®å¤**
- **é—®é¢˜**: æ ¹æŸ¥æ‰¾å™¨å‚æ•°ç¼ºå¤±ï¼Œæ­¥é•¿è®¡ç®—ç®—æ³•é”™è¯¯
- **ä¿®å¤**: æ·»åŠ `iters`å‚æ•°ï¼Œæ”¹è¿›æ­¥é•¿è®¡ç®—åŸºäºè¯¯å·®ä¼°è®¡
- **å½±å“**: æå‡è‡ªé€‚åº”ç§¯åˆ†çš„ç¨³å®šæ€§å’Œç²¾åº¦

#### **5. æ—¶é—´æµ‹è¯•å™¨ä¿®å¤**
- **é—®é¢˜**: æ•°ç»„ç±»å‹å®šä¹‰ä¸æ˜ç¡®
- **ä¿®å¤**: æ˜ç¡®æŒ‡å®š`results`æ•°ç»„ç±»å‹
- **å½±å“**: å¢å¼ºäº‹ä»¶æ—¶é—´éªŒè¯åŠŸèƒ½

### ğŸ“Š æ¶æ„ç¨³å®šæ€§æå‡

#### **ç¼–è¯‘é”™è¯¯ä¿®å¤**
- âœ… æ‰€æœ‰TypeScriptç¼–è¯‘é”™è¯¯å·²ä¿®å¤
- âœ… æ‰€æœ‰linteré”™è¯¯å·²æ¸…é™¤
- âœ… æ‰€æœ‰æ¨¡å—æˆåŠŸç¼–è¯‘ä¸ºJavaScript

#### **è¿è¡Œæ—¶ç¨³å®šæ€§**
- âœ… æ‰€æœ‰æ¨¡å—å¯¼å…¥æˆåŠŸ
- âœ… æ‰€æœ‰ç»„ä»¶åˆå§‹åŒ–æ­£å¸¸
- âœ… æµ‹è¯•æµç¨‹å®Œæ•´è¿è¡Œ

#### **æ€§èƒ½ä¼˜åŒ–**
- âœ… æ”¹è¿›çš„æ­¥é•¿è®¡ç®—ç®—æ³•
- âœ… ä¼˜åŒ–çš„æ¥è§¦ç‚¹åˆå¹¶ç®—æ³•
- âœ… å®‰å…¨çš„å¸§ç‡è§£æå‡½æ•°

### ğŸ§ª æµ‹è¯•éªŒè¯

#### **å¢å¼ºç‰ˆæ¶æ„æµ‹è¯•**
- **æµ‹è¯•æ–‡ä»¶**: `test_fixed_architecture.js`
- **æµ‹è¯•ç»“æœ**: âœ… æˆåŠŸè¿è¡Œ
- **æ€§èƒ½**: æ€»è€—æ—¶21.87ç§’ï¼ˆåŒ…å«AIè§£æ17.66ç§’ï¼‰
- **è¾“å‡º**: æˆåŠŸç”Ÿæˆ59KBçš„MP4è§†é¢‘æ–‡ä»¶
- **VCSè¯„åˆ†**: 0.27ï¼ˆç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼‰

#### **æ¨¡å—å¯¼å…¥éªŒè¯**
```
âœ… æˆåŠŸå¯¼å…¥ PhysicsAIParserAICaller
âœ… æˆåŠŸå¯¼å…¥ adaptAIContract
âœ… æˆåŠŸå¯¼å…¥ validateContract
âœ… æˆåŠŸå¯¼å…¥ simulate
âœ… æˆåŠŸå¯¼å…¥ VCSEvaluator
âœ… æˆåŠŸå¯¼å…¥ FFmpegEncoder
âœ… æˆåŠŸå¯¼å…¥ ContactSolver
âœ… æˆåŠŸå¯¼å…¥ ContactManifoldManager
âœ… æˆåŠŸå¯¼å…¥ RK45Integrator
âœ… æˆåŠŸå¯¼å…¥ EventTimeTester
```

## ğŸš€ æŠ€æœ¯æ ˆ

### åç«¯æœåŠ¡
- **è¯­è¨€**: TypeScript/Node.js
- **æ¶æ„**: æ¨¡å—åŒ–æœåŠ¡æ¶æ„ (v4.1.0 å¢å¼ºç‰ˆ)
- **æ•°æ®åº“**: Supabase (PostgreSQL)
- **è®¤è¯**: Supabase Auth

### å‰ç«¯åº”ç”¨
- **æ¡†æ¶**: Next.js + React
- **æ ·å¼**: TailwindCSS
- **3D æ¸²æŸ“**: Three.js
- **ç±»å‹**: TypeScript

### ç‰©ç†å¼•æ“
- **ä»¿çœŸ**: è‡ªç ”ç‰©ç†ä»¿çœŸå™¨ (v4.1.0 ä¿®å¤ç‰ˆ)
- **æ¸²æŸ“**: Three.js + Canvas
- **å¯¼å‡º**: å¤šç§æ ¼å¼æ”¯æŒ (v4.1.0 å®‰å…¨ç‰ˆ)

## ğŸ“š ä½¿ç”¨æŒ‡å—

### 1. å¼€å‘ç¯å¢ƒè®¾ç½®
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd AI_Ed_SIM

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp frontend/env.example frontend/.env.local

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd frontend
npm run dev
```

### 2. æ ¸å¿ƒé“¾è·¯æµ‹è¯•
```typescript
// 1. è§£æé¢˜ç›®
const question = "ä¸€ç‰©ä½“ä»¥åˆé€Ÿåº¦ v0=20 m/s æ–œæŠ›ï¼Œæ±‚æœ€å¤§é«˜åº¦hã€‚";
const parsedQuestion = parseQuestion(question);

// 2. ç”Ÿæˆ DSL
const dsl = physicsDSLGenerator.generateDSL(parsedQuestion);

// 3. æ‰§è¡Œä»¿çœŸ
const simulator = new PhysicsSimulator();
const result = simulator.simulate(dsl);

// 4. æ¸²æŸ“åŠ¨ç”»
const renderer = new PhysicsRenderer();
renderer.render(result);
```

### 3. æ‰©å±•å¼€å‘
- **æ–°å¢ç‰©ç†ä¸»é¢˜**: åœ¨ `TOPIC_RULES` ä¸­æ·»åŠ è§„åˆ™
- **æ–°å¢ä»¿çœŸç±»å‹**: æ‰©å±• `PhysicsSystemType`
- **æ–°å¢æ¸²æŸ“æ•ˆæœ**: åœ¨ `PhysicsRenderer` ä¸­æ·»åŠ æ–¹æ³•

## ğŸ”® æœªæ¥è§„åˆ’

### 1. çŸ­æœŸç›®æ ‡
- å®Œå–„ä»¿çœŸå¼•æ“çš„ç¨³å®šæ€§
- ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½
- å¢åŠ æ›´å¤šç‰©ç†ä¸»é¢˜æ”¯æŒ

### 2. ä¸­æœŸç›®æ ‡
- æ”¯æŒåŒ–å­¦å’Œç”Ÿç‰©ä»¿çœŸ
- æ·»åŠ æœºå™¨å­¦ä¹ ä¼˜åŒ–
- å®ç°äº‘ç«¯ä»¿çœŸæœåŠ¡

### 3. é•¿æœŸç›®æ ‡
- æ„å»ºå®Œæ•´çš„æ•™è‚²ç”Ÿæ€ç³»ç»Ÿ
- æ”¯æŒå¤šè¯­è¨€å›½é™…åŒ–
- å®ç°è·¨å¹³å°éƒ¨ç½²

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- **GitHub Issues**: æäº¤ bug æŠ¥å‘Šå’ŒåŠŸèƒ½è¯·æ±‚
- **æ–‡æ¡£**: æŸ¥çœ‹è¯¦ç»†çš„ API æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
- **ç¤¾åŒº**: å‚ä¸å¼€å‘è€…ç¤¾åŒºè®¨è®º

## ğŸ§¹ æ–‡ä»¶æ¶æ„ä¼˜åŒ–å»ºè®® - v3.0.0

### **ğŸ¯ ä¼˜åŒ–ç›®æ ‡**
åŸºäºContract-basedç®¡é“å®Œæˆï¼Œæ¸…ç†é‡å¤æ–‡ä»¶ï¼Œç®€åŒ–å¼€å‘ç»“æ„ã€‚

### **ğŸ“Š å½“å‰é—®é¢˜åˆ†æ**
- **é‡å¤æ–‡ä»¶**: 37ä¸ª.js/.tsé‡å¤æ–‡ä»¶é€ æˆç»´æŠ¤å›°éš¾
- **å†—ä½™ç›®å½•**: 12ä¸ªåµŒå¥—é‡å¤ç›®å½•å½±å“ä»£ç å®šä½
- **è¿‡æ—¶ç»„ä»¶**: 7ä¸ªè¢«v3.0.0æ›¿ä»£çš„æ–‡ä»¶å ç”¨ç©ºé—´

### **ğŸ—‘ï¸ å»ºè®®åˆ é™¤çš„æ–‡ä»¶æ¸…å•**

#### **é‡å¤JavaScriptæ–‡ä»¶ (30ä¸ª)**
```bash
# AIè§£ææ¨¡å—é‡å¤ (4ä¸ª)
rm services/ai_parsing/AtomicModules.js
rm services/ai_parsing/PhysicsAIParser.js
rm services/ai_parsing/PhysicsAIParserAICaller.js
rm services/ai_parsing/unitConverter.js

# æ¸²æŸ“æ¨¡å—é‡å¤ (7ä¸ª)
rm services/rendering/CoordinateSystem.js
rm services/rendering/DynamicPhysicsRenderer.js
rm services/rendering/DynamicVideoGenerator.js
rm services/rendering/Physics2DRenderer.js
rm services/rendering/PhysicsRenderFactory.js
rm services/rendering/RenderingManager.js
rm services/rendering/RenderingStrategy.js

# ä»¿çœŸ/IR/æ ¸å¿ƒæ¨¡å—é‡å¤ (19ä¸ª)
find services/ -name "*.js" -type f | grep -E "(simulation|ir|core|dsl)" | head -19
```

#### **å†—ä½™ç›®å½•ç»“æ„ (12ä¸ª)**
```bash
# åˆ é™¤services/core/ä¸‹çš„é‡å¤ç›®å½•
rm -rf services/core/ai_parsing/
rm -rf services/core/dsl/
rm -rf services/core/ir/
rm -rf services/core/rendering/
rm -rf services/core/simulation/
rm -rf services/core/validation/

# åˆ é™¤services/dsl/ä¸‹çš„é‡å¤ç›®å½•
rm -rf services/dsl/ai_parsing/
rm -rf services/dsl/dsl/

# åˆ é™¤services/simulation/ä¸‹çš„åµŒå¥—ç›®å½•
rm -rf services/simulation/simulation/
rm -rf services/simulation/ir/
```

#### **è¿‡æ—¶åŠŸèƒ½æ–‡ä»¶ (7ä¸ª)**
```bash
# v3.0.0åè¢«æ›¿ä»£çš„æ–‡ä»¶
rm services/engine_bridge/PhysicsEngineBridge.ts
rm services/export/AnimationExporter.ts
rm services/export/PhysicsExporter.ts
rm services/feedback/PhyscisFeedback.ts
rm services/feedback/SimulationValidator.ts
rm services/testing/TestAIParser/test_enhanced_system.js
rm services/testing/TestRendering/test_simulation_to_video.js
```

### **âœ… ä¼˜åŒ–åçš„ç²¾ç®€æ¶æ„**

#### **æ ¸å¿ƒç›®å½•ç»“æ„ (ç²¾ç®€35%)**
```
services/
â”œâ”€â”€ ğŸ“ ai_parsing/              # AIè§£æå±‚ (6ä¸ª.tsæ–‡ä»¶)
â”œâ”€â”€ ğŸ“ ir/                      # IRè½¬æ¢å±‚ (6ä¸ªæ–‡ä»¶)
â”œâ”€â”€ ğŸ“ simulation/              # ä»¿çœŸè®¡ç®—å±‚ (8ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ Simulator.ts            # v3.0.0æ ¸å¿ƒ
â”‚   â”œâ”€â”€ integrators/            # RK4/RK45
â”‚   â””â”€â”€ events/                 # äº‹ä»¶æ ¹å®šä½+æ¥è§¦å†²é‡
â”œâ”€â”€ ğŸ“ rendering/               # æ¸²æŸ“å±‚ (11ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ RenderCfgBuilder.ts     # v3.0.0æ ¸å¿ƒ
â”‚   â”œâ”€â”€ CanvasFrameRenderer.ts  # v3.0.0æ ¸å¿ƒ
â”‚   â””â”€â”€ FrameResampler.ts       # v3.0.0æ ¸å¿ƒ
â”œâ”€â”€ ğŸ“ validation/              # éªŒè¯å±‚ (3ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ ResultValidator.ts      # Post-Sim Gate
â”‚   â””â”€â”€ AcceptanceRunner.ts     # æ–­è¨€æ‰§è¡Œå™¨
â”œâ”€â”€ ğŸ“ export/                  # å¯¼å‡ºå±‚ (2ä¸ªæ–‡ä»¶)
â”‚   â””â”€â”€ FFmpegEncoder.ts        # v3.0.0æ ¸å¿ƒ
â”œâ”€â”€ ğŸ“ feedback/                # åé¦ˆå±‚ (2ä¸ªæ–‡ä»¶)
â”œâ”€â”€ ğŸ“ core/                    # æ ¸å¿ƒæ¥å£å±‚ (2ä¸ªæ–‡ä»¶)
â”œâ”€â”€ ğŸ“ dsl/                     # DSLå±‚ (1ä¸ªæ–‡ä»¶)
â””â”€â”€ ğŸ“ testing/                 # æµ‹è¯•å±‚ (ä¿æŒç°çŠ¶)
```

### **ğŸš€ ä¼˜åŒ–æ•ˆæœ**
- **æ–‡ä»¶æ•°é‡**: 107ä¸ª â†’ 70ä¸ª (-35%)
- **ç›®å½•å±‚çº§**: æ›´æ¸…æ™°çš„å±‚æ¬¡ç»“æ„
- **ç»´æŠ¤æˆæœ¬**: æ˜¾è‘—é™ä½
- **å¼€å‘æ•ˆç‡**: æ›´å®¹æ˜“å®šä½å’Œä¿®æ”¹ä»£ç 

---

**ğŸ“… æ–‡æ¡£ç‰ˆæœ¬**: v4.1.0 (2025å¹´1æœˆ)  
**ğŸ¯ ç³»ç»ŸçŠ¶æ€**: ç”Ÿäº§å°±ç»ª (100%å®Œæˆåº¦) - å¢å¼ºç‰ˆæ¶æ„  
**ğŸ† æŠ€æœ¯ç­‰çº§**: å·¥ä¸šçº§ç¡®å®šæ€§ç‰©ç†ä»¿çœŸå¹³å°  
**ğŸ”§ æœ€æ–°æ›´æ–°**: é›†æˆæ‰€æœ‰Debugä¿®å¤å’Œæ”¹è¿›åŠŸèƒ½

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ï¼Œè¯·å…³æ³¨æœ€æ–°ç‰ˆæœ¬*
